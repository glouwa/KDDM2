<head>
    <link href="./visualisations/billboard.css" rel="stylesheet">
    <script src="./visualisations/billboard.pkgd.js"></script>
    <script src="./merge-meta.js"></script>    
    <script src="./htmlcleaned-meta.js"></script>
    <script src="./stemmed-meta.js"></script>
    <script src="./lemmatized-meta.js"></script>
</head>
<body>
    <style>
        body {
            overflow-x: hidden;
            padding: 0;
            margin: 0;
            font-family: "Roboto";
            font-size: 1.4em;
            font-weight: 200;
        }
        body > div:not(.bb){
            background-color: #eee;
            padding: .2em 70;
        }
        .bb path {
            stroke: #f3f3f3;
        }
    </style>

    <div id="downloadheader"></div>    
    <div id="mergeheader"></div>    
    <br>        
    <div id="SCOChart" style="width:42%;float:left;"></div>
    <div id="ANCChart" style="width:42%;float:left;"></div>    
    <div id="ISAChart" style="width:16%;float:left;"></div>    
    <div id="TTFChart"></div>

    <div id="t-cleanedheader"></div>    
    <div id="t-stemmedheader"></div>    
    <div id="t-lemmatizedheader"></div>    
    <br>
    <div id="T-TFChart"></div>
    <div id="T-STFChart"></div>
    <div id="T-LTFChart"></div>
    <br>

    <div id="b-cleanedheader"></div>    
    <div id="b-stemmedheader"></div>    
    <div id="b-lemmatizedheader"></div>    
    <br>
    
    <div id="BTFChart"></div>
    <div id="STFChart"></div>
    <div id="LTFChart"></div>
    <br>

    <div>Precicino</div> 
    <div>Recall</div>     
    
    <script>       
        function write(divid, text){
            document.querySelector(divid).innerText = text
        }
        function plot(divid, data, xlabel, min, small) {
            var entries = Object.entries(data)
            entries = entries.sort((a, b)=> b[1] - a[1])
            entries = entries.filter(e=> e[1] > min)

            var numbers = entries.map(e=> e[1])
            var labels = entries.map(e=> e[0])

            var chart = bb.generate({
                size: {
                    height: small?120:200,                    
                },
                data: {
                    columns: [[xlabel].concat(numbers)],
                    type: "bar"
                },
                bar: { width: { ratio: 1 }},
                axis: {
                    x: {
                        type: "category",
                        categories: labels,                       
                        tick: {
                            count: small?10:undefined,       
                            fit: true,                     
                            rotate: 90, 
                            multiline: false,
                        },
                    },
                    y: {
                        tick: { count:2, format:x=> x.toFixed(0) }
                    }
                },
                padding: {    
                    left: 70,
                    right: 70,
                },   
                //zoom: { enabled: true },
                bindto: divid
            })
        }

        write("#downloadheader",     `Downloaded: ${mergemeta.files} Files, ${mergemeta.rawquestions} Raw-Questions, ${mergemeta.dupquestions} duplicate, ${mergemeta.errquestions} invalid`)
        write("#mergeheader",        `Merged: ${(mergemeta.size/1024/1024).toFixed(0)}MB, ${mergemeta.questions} Valid-Questions, ${mergemeta.tagcount} Tags`)
        plot("#SCOChart",            mergemeta.scodist, "Question Score distribution", 0, true)
        plot("#ANCChart",            mergemeta.ancdist, "Answer Count distribution", 0, true)
        plot("#ISAChart",            mergemeta.isadist, "Is Answered distribution", 0, true)
        plot("#TTFChart",            mergemeta.tagdist, "Tag frequency", 50)

        write("#t-cleanedheader",    `Title Cleaned: ${htmlcleanedmeta.titletermcount} Terms`)
        write("#t-stemmedheader",    `Title Stemmed: ${Object.keys(stemmeta.title_terms).length} stemmed Terms`)
        write("#t-lemmatizedheader", `Title Lemmatized: ${Object.keys(lemmmeta.title_terms).length} lemmed Terms`)
        plot("#T-TFChart",            htmlcleanedmeta.titletermdist, "Title Term frequency (cleaned)", 100)
        plot("#T-STFChart",           stemmeta.title_terms, "Title Term frequency (stemmed)", 200)
        plot("#T-LTFChart",           lemmmeta.title_terms, "Title Term frequency (lemmed)", 200)

        write("#b-cleanedheader",    `Body Cleaned: ${htmlcleanedmeta.termcount} Terms`)
        write("#b-stemmedheader",    `Body Stemmed: ${Object.keys(stemmeta.body_terms).length} stemmed Terms`)
        write("#b-lemmatizedheader", `Body Lemmatized: ${Object.keys(lemmmeta.body_terms).length} lemmed Terms`)
        plot("#BTFChart",            htmlcleanedmeta.termdist, "Body terms frequency (cleaned)", 800)        
        plot("#STFChart",            stemmeta.body_terms, "Body terms frequency (stemmed)", 1200)        
        plot("#LTFChart",            lemmmeta.body_terms, "Body terms frequency (lemmed)", 1200)
    </script>
</body>